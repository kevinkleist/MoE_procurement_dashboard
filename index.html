<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoE | Localization Audit Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;600;700&family=Inter:wght@400;600;700&display=swap');
        
        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: #f1f5f9;
            height: 100vh;
            width: 100vw;
        }
        .font-en { font-family: 'Inter', sans-serif; }
        .font-ar { font-family: 'IBM Plex Sans Arabic', sans-serif; }
        
        .gradient-moe { background: linear-gradient(135deg, #006C35 0%, #004d26 100%); }
        .row-active { background-color: #f0fdf4 !important; border-inline-start: 6px solid #006C35; }
        
        /* Ensure charts take up full container space */
        .chart-container { position: relative; flex-grow: 1; min-height: 0; width: 100%; }
        
        /* Custom scrollbar for the table */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="flex flex-col transition-all duration-300">

    <nav class="gradient-moe text-white px-8 py-4 flex justify-between items-center shadow-xl shrink-0">
        <div class="flex items-center gap-6">
            <div class="h-12 w-12 bg-white rounded-full flex items-center justify-center font-bold text-[#006C35] shadow-inner text-lg">MoE</div>
            <div>
                <h2 id="dept-name" class="text-xs opacity-90 uppercase tracking-[0.2em] font-semibold"></h2>
                <h1 id="project-name" class="text-xl font-bold tracking-tight"></h1>
            </div>
        </div>
        <button onclick="resetFilter()" id="btn-reset" class="hidden px-6 py-2 bg-white/20 hover:bg-white/40 rounded-lg text-sm font-semibold transition-all backdrop-blur-md border border-white/10"></button>
    </nav>

    <main class="flex-grow p-6 grid grid-cols-12 gap-6 min-h-0">
        
        <div class="col-span-12 lg:col-span-4 flex flex-col gap-6">
            
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200 flex flex-col items-center justify-center flex-[1.5]">
                <h3 id="label-gauge" class="text-slate-400 font-bold text-sm mb-6 uppercase tracking-widest"></h3>
                <div class="relative w-64 h-64">
                    <canvas id="gaugeChart"></canvas>
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <span id="gauge-val" class="text-5xl font-black text-slate-800">22.4%</span>
                        <span id="target-met" class="text-xs text-green-600 font-bold mt-2 px-3 py-1 bg-green-50 rounded-full"></span>
                    </div>
                </div>
            </div>

            <div class="flex flex-col gap-4 flex-grow">
                <div class="bg-white px-8 py-6 rounded-3xl shadow-sm border-s-[12px] border-[#006C35] flex flex-col justify-center flex-grow">
                    <p id="lbl-procured" class="text-xs text-slate-400 font-bold uppercase mb-1"></p>
                    <p id="val-procured" class="text-3xl font-black text-slate-800 tracking-tight">412,500</p>
                </div>

                <div class="bg-white px-8 py-6 rounded-3xl shadow-sm border-s-[12px] border-blue-500 flex flex-col justify-center flex-grow">
                    <p id="lbl-local" class="text-xs text-slate-400 font-bold uppercase mb-1"></p>
                    <p id="val-local" class="text-3xl font-black text-slate-800 tracking-tight">92,400</p>
                </div>

                <div class="bg-white px-8 py-6 rounded-3xl shadow-sm border-s-[12px] border-orange-400 flex flex-col justify-center flex-grow">
                    <p id="lbl-contractors" class="text-xs text-slate-400 font-bold uppercase mb-1"></p>
                    <p id="val-contractors" class="text-3xl font-black text-slate-800 tracking-tight">12</p>
                </div>
            </div>
        </div>

        <div class="col-span-12 lg:col-span-8 flex flex-col gap-6 min-h-0">
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200 flex flex-col flex-[1.2]">
                <div class="flex justify-between items-center mb-6">
                    <h3 id="label-trend" class="text-slate-800 font-black text-lg"></h3>
                    <div class="flex gap-2">
                        <span class="w-3 h-3 bg-[#006C35] rounded-full"></span>
                        <span class="text-[10px] text-slate-400 font-bold uppercase tracking-tighter">Live Audit Stream</span>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="lineChart"></canvas>
                </div>
            </div>

            <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden flex flex-col flex-grow">
                <div class="px-8 py-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/30">
                    <h3 id="label-table" class="text-sm font-black text-slate-700 uppercase tracking-widest"></h3>
                    <span id="filter-status" class="text-xs font-bold text-[#006C35] animate-pulse"></span>
                </div>
                <div class="overflow-y-auto flex-grow custom-scroll">
                    <table class="w-full text-inline-start border-collapse">
                        <thead class="bg-slate-50/80 sticky top-0 text-slate-400 text-xs font-bold uppercase">
                            <tr id="table-head"></tr>
                        </thead>
                        <tbody id="table-body" class="divide-y divide-slate-100">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script>
        const i18n = {
            en: {
                dept: "Technology and Localization Department",
                project: "Al-Khushaybi Solar PV Project",
                gauge: "Total Localization Progress",
                target: "20% Requirement",
                procured: "Total Units Procured",
                local: "KSA Manufactured",
                contractors: "Active Contractors",
                trend: "Procurement Submission Velocity",
                table: "Audit Log & Contractor Feed",
                reset: "Back to Global View",
                viewing: "AUDITING: ",
                cols: ["Contractor", "Batch Identifier", "Origin Status", "Local Content"],
                months: ["Oct", "Nov", "Dec", "Jan", "Feb"]
            },
            ar: {
                dept: "إدارة التكنولوجيا والتوطين",
                project: "مشروع الخشيبي للطاقة الشمسية",
                gauge: "إجمالي التقدم في التوطين",
                target: "المتطلب 20%",
                procured: "إجمالي الوحدات المشتراة",
                local: "صنع في السعودية",
                contractors: "المقاولون النشطون",
                trend: "سرعة تقديم المشتريات",
                table: "سجل التدقيق وبيانات المقاولين",
                reset: "العودة للعرض العام",
                viewing: "جاري تدقيق: ",
                cols: ["المقاول", "معرف الدفعة", "حالة المنشأ", "المحتوى المحلي"],
                months: ["أكتوبر", "نوفمبر", "ديسمبر", "يناير", "فبراير"]
            }
        };

        const isAr = navigator.language.startsWith('ar');
        const t = isAr ? i18n.ar : i18n.en;
        document.body.dir = isAr ? 'rtl' : 'ltr';
        document.body.classList.add(isAr ? 'font-ar' : 'font-en');

        const contractors = [
            { name: "ACWA Power", val: 150000, localVal: 142500, localPct: 95, history: [10, 25, 40, 80, 150] },
            { name: "Al-Fannar", val: 82000, localVal: 72160, localPct: 88, history: [5, 15, 30, 45, 82] },
            { name: "L&T Energy", val: 120500, localVal: 14460, localPct: 12, history: [20, 40, 60, 90, 120] },
            { name: "Desert Tech", val: 60000, localVal: 60000, localPct: 100, history: [10, 20, 35, 50, 60] }
        ];

        let lineChart, gaugeChart;

        function init() {
            document.getElementById('dept-name').innerText = t.dept;
            document.getElementById('project-name').innerText = t.project;
            document.getElementById('label-gauge').innerText = t.gauge;
            document.getElementById('target-met').innerText = t.target;
            document.getElementById('lbl-procured').innerText = t.procured;
            document.getElementById('lbl-local').innerText = t.local;
            document.getElementById('lbl-contractors').innerText = t.contractors;
            document.getElementById('label-trend').innerText = t.trend;
            document.getElementById('label-table').innerText = t.table;
            document.getElementById('btn-reset').innerText = t.reset;

            const tableHead = document.getElementById('table-head');
            t.cols.forEach(c => tableHead.innerHTML += `<th class="px-8 py-4">${c}</th>`);

            renderTable();
            initCharts();
        }

        function renderTable() {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';
            contractors.forEach(c => {
                const row = document.createElement('tr');
                row.className = "hover:bg-slate-50 cursor-pointer transition-all text-sm";
                row.onclick = () => filterByContractor(c, row);
                row.innerHTML = `
                    <td class="px-8 py-5 font-bold text-[#006C35] text-base">${c.name}</td>
                    <td class="px-8 py-5 text-slate-400 font-mono">SA-EXP-${Math.floor(Math.random()*90000)}</td>
                    <td class="px-8 py-5 font-semibold text-slate-600">${c.localPct > 50 ? (isAr ? 'إنتاج محلي' : 'Domestic') : (isAr ? 'مستورد خارجي' : 'International')}</td>
                    <td class="px-8 py-5">
                        <div class="flex items-center gap-3">
                            <div class="w-16 bg-slate-100 h-2 rounded-full overflow-hidden">
                                <div class="h-full ${c.localPct < 20 ? 'bg-red-500' : 'bg-[#006C35]'}" style="width: ${c.localPct}%"></div>
                            </div>
                            <span class="font-black ${c.localPct < 20 ? 'text-red-600' : 'text-slate-800'}">${c.localPct}%</span>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function initCharts() {
            Chart.defaults.font.family = isAr ? 'IBM Plex Sans Arabic' : 'Inter';
            
            lineChart = new Chart(document.getElementById('lineChart'), {
                type: 'line',
                data: {
                    labels: t.months,
                    datasets: [{
                        data: [50, 100, 165, 265, 412],
                        borderColor: '#006C35',
                        borderWidth: 4,
                        backgroundColor: 'rgba(0, 108, 53, 0.08)',
                        fill: true, tension: 0.4, pointRadius: 6, pointBackgroundColor: '#fff', pointBorderWidth: 3
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { legend: { display: false } },
                    scales: { 
                        y: { position: isAr ? 'right' : 'left', grid: { color: '#f1f5f9' }, border: { display: false } },
                        x: { grid: { display: false } }
                    }
                }
            });

            gaugeChart = new Chart(document.getElementById('gaugeChart'), {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [22.4, 77.6],
                        backgroundColor: ['#006C35', '#f1f5f9'],
                        circumference: 180, rotation: 270, cutout: '88%', borderWidth: 0
                    }]
                },
                options: { plugins: { tooltip: { enabled: false } } }
            });
        }

        function filterByContractor(c, rowElement) {
            document.querySelectorAll('tr').forEach(r => r.classList.remove('row-active'));
            rowElement.classList.add('row-active');
            document.getElementById('btn-reset').classList.remove('hidden');
            document.getElementById('filter-status').innerText = t.viewing + c.name;

            document.getElementById('gauge-val').innerText = c.localPct + "%";
            document.getElementById('val-procured').innerText = c.val.toLocaleString();
            document.getElementById('val-local').innerText = c.localVal.toLocaleString();
            document.getElementById('val-contractors').innerText = "1";
            
            gaugeChart.data.datasets[0].data = [c.localPct, 100 - c.localPct];
            gaugeChart.data.datasets[0].backgroundColor = [c.localPct < 20 ? '#ef4444' : '#006C35', '#f1f5f9'];
            gaugeChart.update();

            lineChart.data.datasets[0].data = c.history;
            lineChart.update();
        }

        function resetFilter() {
            document.getElementById('btn-reset').classList.add('hidden');
            document.getElementById('filter-status').innerText = "";
            document.getElementById('gauge-val').innerText = "22.4%";
            document.getElementById('val-procured').innerText = "412,500";
            document.getElementById('val-local').innerText = "92,400";
            document.getElementById('val-contractors').innerText = "12";
            
            renderTable();
            gaugeChart.data.datasets[0].data = [22.4, 77.6];
            gaugeChart.data.datasets[0].backgroundColor = ['#006C35', '#f1f5f9'];
            gaugeChart.update();

            lineChart.data.datasets[0].data = [50, 100, 165, 265, 412];
            lineChart.update();
        }

        init();
    </script>
</body>
</html>
